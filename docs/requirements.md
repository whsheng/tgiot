**产品需求**

----

### 通用需求

+ 设备开机通电运行过程中，如果检测到SIM卡有变化，应立即向平台通报变化，以便平台及时更新设备与卡的关系；
+ 设备首次开机通电、网络连接的情况下，应主动向平台发起服务请求。获取设备连接参数，如：网关接入IP和Port、设备密钥等信息，这些信息用于设备与平台数据交互；
+ 测试卡管理：设备在生产阶段，是要经过生产线的测试人员带卡开机测试，因此平台要支持对这些测试卡的管理。平台要能够判断出：如果设备带上来的卡信息是属于测试卡，则不能被注册到平台，并且由平台返回「测试通知」给设备；
+ 在整个平台中，是以设备的纬度进行管理(如：位置、图片、报警等数据），因此一个设备上的ICCID信息可以更换。同时在这个平台上面，也能够清楚知道卡的变更、续费记录等；
+ 设备的唯一标识码就是设备IMEI，不用考虑把ICCID带进去。因为这样做，会导致卡发生变化后，设备唯一标识符出问题；
+ 设备端产生的图片、视频后，自行传到云端(七牛云)后，再将存储地址通知到平台；
+ 支持平台端的下行指令，如：远程拍照、设置上传间隔等常用指令； 
+ 持对设备位置信息、报警信息处理、入库;

### WEB需求  
+ 角色权限管理
  - 角色管理：创建管理各类角色，每个角色都可以拥有不同权限(即功能点），1个用户可以只能对应1个角色；
  - 权限管理：CRUD平台上面的各类功能点；

+ 系统管理
  - 字典表管理：平台中需要用到的各类字典表信息，统一在这里进行管理
  - 角色、权限、账号管理；
  - 支持对「测试卡」的管理；

+ 用户管理
  - 这里的用户是指使用平台的B端用户，即：代理商、渠道商；
  - 创建用户：用户名(登录名)、显示呢称、密码、角色、所属上级用户、联系方式、所在地；
  - 用户树：以树形结构展示当前账号下用户组织关系；
  - 用户类型(角色)：运营商、经销商、4s运营商、4s经销商、车主、运营(演示)，这些用户类型，可以通过角色概念进行创建、分配；
  - 每个用户下面，可以无限创建子用户和管理N台设备；
  - 用户的删除管理时，必须确保该用户下没有了设备列表，或者说这些设备信息必须先转移到其它用户结点下面；
  - 支持根据用户名的关键字进行模糊查找用户；
  - 点击用户结点时，异步加载该用户下的设备信息；

+ 设备管理
  - 设备列表：以表格形式展现当前用户下的设备列表（包括设备基本属性，如：设备IMEI、ICCID、最后更新时间、位置等)
  - 支持点击「某台设备」时，查看设备详情（IMEI、ICCID、版本号等）
  - 支持查看设备最新位置、历史轨迹、图片、视频、报警信息等
  - 支持通过云端对设备进行远程控制，如：拍照、视频、下发文本信息等
  - 支持对设备信息的指导入、导出；

+ 微信管理
  - 微信平台管理，查看已部署、实现的各个微信平台信息；
  - 微信用户管理：展现已授权的微信用户基本信息，可以了解到该微信用户关联了哪些设备、续费记录等情况；

+ 卡务管理
  - 流量卡列表：以列表形式展现流量卡的基本信息，如：卡号、ICCID、IMEI、卡源、状态（是否激活）、关联设备、到期日、流量余额、续费记录等；
  - 支持卡信息的指导入、导出；

+ 渠道管理


+ 位置管理：设备当前位置显示、历史轨迹查看、电子围栏管理
  - 查看设备当前位置、历史轨迹、支持百度或高德地图展现；
  - 设备所属的目标类型不同，则图标不同；
  - 设备不同状态时，在地图上显示的图标状态也不同；
  - 支付对设备进行围栏管理（CRUD），一台设备可以支持多个围栏，每个围栏可以是多边形，围栏报警类型为：进、出、进出、长时间停留；


+ 4S店管理（运营服务）
  - 车辆档案管理
  - 预约提醒、直观展现各类提醒服务，即将到期、预约情况；
  - 营销服务：通过在平台向目标设备推送营销活动，设备上展现。用户可以点击查看、转换成线下服务；


### 微信公众号
+ 设备管理：扫码绑定、列表、解绑；
+ 位置服务：当前位置、历史轨迹；
+ 远程控制：拍照、视频；
+ 报警推送：服务到期提醒、进出围栏报警、震动报警、非法启动报警；
+ 充值管理：续费、历史续费；


### 业务处理服务(BPS)
+ 封装IoT-Hub与MNS的SDK，支持与这两者进行通信，实现上行指令的获取与下行指令的下发；
+ 获取设备状态列表，能够直观看到当前所有+设备的信息；
+ 直观地看到从MNS中订阅的内容
+ 选择某个指定的设备，直接下发各类控制指令；
+ 解析位置信息，将其保存到DB；
+ 提供通知类接口，用于获取设备基本信息变更、平台下行指令等。





